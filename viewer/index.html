<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<script src="/assets/tailwind-3.4.3.min.js"></script>
		<script defer src="/assets/alpinejs-3.13.8.min.js"></script>
		<script src="/assets/marked-12.0.1.min.js"></script>
		<script>
		const formatDate = (dateStr) => {
			const date = new Date(dateStr);
			const month = (date.getMonth() + 1).toString().padStart(2, '0');
			const day = date.getDay().toString().padStart(2, '0');
			const year = date.getFullYear().toString().substr(-2);
			return `${month}/${day}/${year}`;
		}
		const getPosts = async () => {
			return (await (await fetch('/posts.json')).json()).posts;
		}
		const getFollowups = (followups) => {
			return followups?.filter((followup) => (followup.type === "followup"))
		}
		</script>
	</head>
	<body>
		<div class="grid grid-cols-4"
			x-data="{ posts: [], currentPost: { history: [{ subject: '', content: '' }], created: '' } }"
			x-init="posts = await getPosts(); currentPost = posts[0]"
			>
			<div class="bg-gray-800 h-[100vh] col-span-1 overflow-y-scroll">
				<template x-for="post in posts" :key="post.id">
					<div
						class="bg-gray-700 hover:bg-gray-600 text-gray-300 p-4 space-y-1 border-x border-t border-gray-600 select-none"
						x-on:click="currentPost = post"
						x-data="{ h0: post.history[0] }"
						>
						<div class="flex justify-between pointer-events-none">
							<h1
								class="text-sm font-bold"
								x-html="marked.parse(h0.subject)"
							></h1>
							<p
								class="text-sm"
								x-text="formatDate(h0.created)"
							></p>
						</div>
						<div class="h-12 overflow-hidden pointer-events-none">
							<span class="text-xs" x-html="marked.parse(h0.content)"></span>
						</div>
					</div>
				</template>
			</div>
			<div class="bg-gray-900 h-[100vh] col-span-3 overflow-y-scroll">
				<div class="bg-gray-800 p-8 mx-4 my-2 text-white border border-gray-700 rounded-lg space-y-6">
					<div class="font-bold text-xl">
						<span x-html="marked.parse(currentPost.history[0].subject)"></span>
					</div>
					<div class="overflow-x-scroll">
						<span
							class="text-sm space-y-2"
							x-html="marked.parse(currentPost.history[0].content)"
						></span>
					</div>
				</div>

				<div
					class="bg-gray-800 p-8 mx-4 my-2 text-white border border-gray-700 rounded-lg space-y-4"
				>
					<h1 class="font-bold text-xl">followup discussions</h1>
					<template x-for="followup in getFollowups(currentPost.children)" :key="followup.id">
						<div class="bg-gray-700 py-4 px-6 rounded-md">
							<div class="space-y-1 pb-2">
								<div class="flex gap-x-2 text-sm">
									<span class="font-bold" x-text="followup.uid ?? followup.uid_a"></span>
									<span x-text="formatDate(followup.created)"></span>
								</div>
								<div class="overflow-x-scroll">
									<span
										class="text-sm"
										x-html="marked.parse(followup.subject)"
									></span>
								</div>
							</div>
							<span
								class="text-xs"
								x-text="`helpful! | ${followup.tag_good.length}`"
							></span>
						</div>
					</template>
				</div>
			</div>
		</div>
	</body>
</html>
